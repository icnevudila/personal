'use client'

import { motion } from 'framer-motion'
import { useInView } from 'framer-motion'
import { useRef, useState, useEffect } from 'react'
import { CalendarIcon, ClockIcon, ArrowRightIcon, PencilIcon, TrashIcon, PlusIcon, XMarkIcon, CheckIcon, PhotoIcon } from '@heroicons/react/24/outline'
import Link from 'next/link'
import { useLanguage } from '@/contexts/LanguageContext'
import { AnimatedText } from './AnimatedText'
import { uploadImageToSupabase } from '@/lib/supabase-storage'
import { getAllBlogPosts, saveBlogPost } from '@/lib/blog-database'

interface BlogPost {
  id?: number
  title: string
  excerpt: string
  date: string
  readTime: string
  slug: string
  category: string
  featured?: boolean
  content?: string
  image?: string
  published?: boolean
}

interface BlogProps {
  isHomePage?: boolean
}

export function Blog({ isHomePage = false }: BlogProps) {
  const { t } = useLanguage()
  const ref = useRef(null)
  const isInView = useInView(ref, { once: true, margin: '-100px' })
  const [editingId, setEditingId] = useState<number | null>(null)
  const [editForm, setEditForm] = useState<Partial<BlogPost>>({})
  const [showEditModal, setShowEditModal] = useState(false)
  const [showAddModal, setShowAddModal] = useState(false)
  const [isAdmin, setIsAdmin] = useState(false)
  const [showPasswordModal, setShowPasswordModal] = useState(false)
  const [password, setPassword] = useState('')
  const [currentPage, setCurrentPage] = useState(1)
  const [postsPerPage] = useState(isHomePage ? 4 : 6)

  // Admin password from environment variable
  const ADMIN_PASSWORD = process.env.NEXT_PUBLIC_ADMIN_PASSWORD || 'icnevudila2024'

  useEffect(() => {
    const checkAdminMode = () => {
      const adminMode = localStorage.getItem('adminMode')
      setIsAdmin(adminMode === 'true')
    }
    
    checkAdminMode()
    
    // Check every second for admin mode changes
    const interval = setInterval(checkAdminMode, 1000)
    
    return () => clearInterval(interval)
  }, [])

  const handlePasswordSubmit = () => {
    if (password === ADMIN_PASSWORD) {
      setIsAdmin(true)
      localStorage.setItem('adminMode', 'true')
      setShowPasswordModal(false)
      setPassword('')
    } else {
      alert('Yanlış şifre!')
      setPassword('')
    }
  }

  // Generate 100 blog posts
  const generateBlogPosts = (): BlogPost[] => {
    const categories = ['Design', 'Development', 'AI', 'Performance', 'UX/UI', 'Technology', 'Tutorial', 'Case Study']
    const topics = [
      'Modern Web Tasarımı', 'React Best Practices', 'AI ve Yaratıcılık', 'Performance Optimization',
      'User Experience', 'Mobile First Design', 'CSS Grid', 'JavaScript ES6+', 'TypeScript',
      'Next.js', 'Tailwind CSS', 'Framer Motion', 'Responsive Design', 'Accessibility',
      'SEO Optimization', 'Web Security', 'API Design', 'Database Design', 'Cloud Computing',
      'DevOps', 'Git Workflow', 'Testing Strategies', 'Code Review', 'Agile Development',
      'Design Systems', 'Color Theory', 'Typography', 'Layout Design', 'Animation',
      'Micro-interactions', 'User Research', 'Prototyping', 'Wireframing', 'Information Architecture',
      'Content Strategy', 'Branding', 'Logo Design', 'Visual Hierarchy', 'White Space',
      'Contrast', 'Balance', 'Proximity', 'Alignment', 'Repetition', 'Consistency',
      'Scalability', 'Maintainability', 'Code Quality', 'Documentation', 'Version Control',
      'Deployment', 'Monitoring', 'Analytics', 'A/B Testing', 'Conversion Optimization',
      'Landing Pages', 'E-commerce', 'SaaS Design', 'Dashboard Design', 'Data Visualization',
      'Charts', 'Graphs', 'Infographics', 'Icons', 'Illustrations', 'Photography',
      'Video Content', 'Podcast Design', 'Social Media', 'Email Marketing', 'Content Marketing',
      'Growth Hacking', 'Startup', 'Freelancing', 'Remote Work', 'Productivity',
      'Time Management', 'Project Management', 'Client Relations', 'Pricing Strategies',
      'Portfolio Building', 'Networking', 'Career Development', 'Learning', 'Mentoring',
      'Community Building', 'Open Source', 'Contributing', 'Speaking', 'Writing',
      'Teaching', 'Consulting', 'Agency', 'Studio', 'Team Building', 'Leadership',
      'Innovation', 'Trends', 'Future', 'Predictions', 'Analysis', 'Reviews'
    ]

    const posts: BlogPost[] = []
    
    for (let i = 1; i <= 100; i++) {
      const topic = topics[Math.floor(Math.random() * topics.length)]
      const category = categories[Math.floor(Math.random() * categories.length)]
      
      // İlk 60 yazı: bugüne kadar (geçmiş tarihler)
      // Sonraki 40 yazı: gelecek 40 gün
      let date: Date
      if (i <= 60) {
        date = new Date(2024, 11, 20 - i + 1) // Bugünden başlayarak geçmişe
      } else {
        date = new Date(2024, 11, 21 + (i - 60)) // Gelecek 40 gün
      }
      
      const published = i <= 60 // İlk 60 yazı published
      
      posts.push({
        id: i,
        title: `${topic}: ${i}. Adımda Uzmanlaşma`,
        slug: `${topic.toLowerCase().replace(/[^a-z0-9]/g, '-')}-${i}`,
        excerpt: `${topic} konusunda ${i}. seviyeye ulaşmak için bilmeniz gereken temel prensipler ve uygulamalar. Bu kapsamlı rehber ile ${category} alanında uzmanlaşın.`,
        content: `# ${topic}: ${i}. Adımda Uzmanlaşma

Bu kapsamlı rehberde ${topic} konusunda ${i}. seviyeye ulaşmak için bilmeniz gereken tüm detayları bulacaksınız.

## Temel Kavramlar

${topic} alanında başarılı olmak için öncelikle temel kavramları anlamanız gerekiyor. Bu kavramlar:

- Temel prensipler ve teorik altyapı
- Best practices ve endüstri standartları
- Yaygın hatalar ve bunlardan kaçınma yolları
- Optimizasyon teknikleri ve performans iyileştirmeleri

## Pratik Uygulamalar

Teorik bilgiyi pratiğe dökmek için:

1. **Proje örnekleri**: Gerçek dünya senaryolarında ${topic} nasıl uygulanır
2. **Kod parçacıkları**: Kullanıma hazır kod örnekleri ve açıklamaları
3. **Gerçek dünya senaryoları**: Endüstri deneyimleri ve case study'ler
4. **Problem çözme yaklaşımları**: Karşılaşılan sorunlar ve çözüm yöntemleri

## Detaylı İçerik

${topic} konusunda derinlemesine bilgi sahibi olmak için:

### Alt Başlık 1: Temel Prensipler
${topic} alanında başarılı olmak için bilmeniz gereken temel prensipler şunlardır:

- **Prensip 1**: Detaylı açıklama ve örnekler
- **Prensip 2**: Uygulama alanları ve kullanım senaryoları
- **Prensip 3**: Avantajları ve dezavantajları

### Alt Başlık 2: İleri Seviye Teknikler
${i}. seviyeye ulaştıktan sonra öğrenebileceğiniz teknikler:

- **Teknik 1**: Gelişmiş optimizasyonlar ve performans iyileştirmeleri
- **Teknik 2**: Ölçeklenebilir çözümler ve mimari desenler
- **Teknik 3**: Gelecek trendleri ve teknoloji öngörüleri

### Alt Başlık 3: Pratik Örnekler
Gerçek projelerde ${topic} nasıl uygulanır:

\`\`\`javascript
// Örnek kod bloğu
function ${topic.toLowerCase().replace(/[^a-z0-9]/g, '')}Example() {
  // Detaylı kod açıklaması
  return "Başarılı sonuç";
}
\`\`\`

## Sonuç ve Öneriler

${topic} konusunda ${i}. seviyeye ulaşmak sabır ve pratik gerektirir. Bu rehberdeki adımları takip ederek başarıya ulaşabilirsiniz.

### Önemli Noktalar:
- Sürekli öğrenme ve güncel kalma
- Pratik yapma ve proje geliştirme
- Topluluk ile etkileşim ve deneyim paylaşımı
- Mentoring ve geri bildirim alma

### Gelecek Adımlar:
1. Bu rehberdeki bilgileri pratikte uygulayın
2. Daha ileri seviye kaynakları araştırın
3. Projelerinizde bu teknikleri kullanın
4. Deneyimlerinizi başkalarıyla paylaşın

Bu yolculukta başarılar dileriz! 🚀`,
        date: date.toISOString().split('T')[0],
        readTime: `${Math.floor(Math.random() * 10) + 3} dk okuma`,
        category: category,
        featured: i <= 6, // İlk 6 yazı featured
        image: i <= 6 ? `/portfolio/blog-${i}.jpg` : undefined,
        published: published
      })
    }
    
    return posts.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()) // Tarihe göre sırala
  }

  const [allBlogPosts, setAllBlogPosts] = useState<BlogPost[]>(generateBlogPosts())
  const [blogPosts, setBlogPosts] = useState<BlogPost[]>([])

  useEffect(() => {
    // Always use generated posts for now (100 posts with 60 published)
    const generatedPosts = generateBlogPosts()
    setAllBlogPosts(generatedPosts)
    setBlogPosts(generatedPosts.filter(post => post.published !== false))
    
    // Save to localStorage
    localStorage.setItem('blogPosts', JSON.stringify(generatedPosts))
    
    console.log('Generated posts:', generatedPosts.length)
    console.log('Published posts:', generatedPosts.filter(post => post.published !== false).length)
  }, [])

  const handleEdit = (post: BlogPost, index: number) => {
    setEditingId(index)
    setEditForm(post)
    setShowEditModal(true)
  }

  const handleSaveEdit = () => {
    if (editingId !== null) {
      const updated = [...blogPosts]
      updated[editingId] = { ...updated[editingId], ...editForm } as BlogPost
      setBlogPosts(updated)
      localStorage.setItem('blogPosts', JSON.stringify(updated))
      setShowEditModal(false)
      setEditingId(null)
      setEditForm({})
      alert('Blog yazısı başarıyla güncellendi!')
    }
  }

  const handleDelete = (index: number) => {
    if (confirm('Bu blog yazısını silmek istediğinizden emin misiniz?')) {
      const updated = blogPosts.filter((_, i) => i !== index)
      setBlogPosts(updated)
      localStorage.setItem('blogPosts', JSON.stringify(updated))
      alert('Blog yazısı silindi!')
    }
  }

  const handleTogglePublish = (index: number) => {
    const updatedPosts = [...allBlogPosts]
    updatedPosts[index].published = !updatedPosts[index].published
    setAllBlogPosts(updatedPosts)
    setBlogPosts(updatedPosts.filter(post => post.published !== false))
    
    // Save to localStorage
    localStorage.setItem('blogPosts', JSON.stringify(updatedPosts))
    
    // Save to Supabase if available
    if (updatedPosts[index].id) {
      saveBlogPost(updatedPosts[index])
    }
    
    alert(`Blog yazısı ${updatedPosts[index].published ? 'yayınlandı' : 'yayından kaldırıldı'}!`)
  }

  const handleAdd = () => {
    const newPost: BlogPost = {
      title: '',
      excerpt: '',
      date: new Date().toISOString().split('T')[0],
      readTime: '5 min read',
      slug: '',
      category: 'Design',
      featured: false,
      content: '',
    }
    setEditForm(newPost)
    setShowAddModal(true)
  }

  const handleSaveAdd = () => {
    if (editForm.title && editForm.slug) {
      const newPost = { ...editForm } as BlogPost
      const updated = [newPost, ...blogPosts]
      setBlogPosts(updated)
      localStorage.setItem('blogPosts', JSON.stringify(updated))
      setShowAddModal(false)
      setEditForm({})
      alert('Yeni blog yazısı eklendi!')
    } else {
      alert('Lütfen başlık ve slug girin!')
    }
  }

  const handleCancel = () => {
    setShowEditModal(false)
    setShowAddModal(false)
    setEditingId(null)
    setEditForm({})
  }


  const containerVariants = {
    hidden: { opacity: 0 },
    visible: {
      opacity: 1,
      transition: {
        staggerChildren: 0.1,
        delayChildren: 0.1,
      },
    },
  }

  const itemVariants = {
    hidden: { opacity: 0, y: 30 },
    visible: {
      opacity: 1,
      y: 0,
      transition: {
        duration: 0.6,
        ease: 'easeOut',
      },
    },
  }

  const getCategoryColor = (category: string) => {
    const colors = {
      Development: 'bg-blue-500/20 text-blue-400 border-blue-500/30',
      Design: 'bg-purple-500/20 text-purple-400 border-purple-500/30',
      Performance: 'bg-green-500/20 text-green-400 border-green-500/30',
      AI: 'bg-orange-500/20 text-orange-400 border-orange-500/30',
      'UX/UI': 'bg-pink-500/20 text-pink-400 border-pink-500/30',
      Technology: 'bg-cyan-500/20 text-cyan-400 border-cyan-500/30',
      Tutorial: 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30',
      'Case Study': 'bg-indigo-500/20 text-indigo-400 border-indigo-500/30',
    }
    return colors[category as keyof typeof colors] || 'bg-gray-500/20 text-gray-400 border-gray-500/30'
  }

  const getCategoryGradient = (category: string) => {
    const gradients = {
      Development: 'rgba(59,130,246,0.3)',
      Design: 'rgba(147,51,234,0.3)',
      Performance: 'rgba(34,197,94,0.3)',
      AI: 'rgba(249,115,22,0.3)',
      'UX/UI': 'rgba(236,72,153,0.3)',
      Technology: 'rgba(6,182,212,0.3)',
      Tutorial: 'rgba(234,179,8,0.3)',
      'Case Study': 'rgba(99,102,241,0.3)',
    }
    return gradients[category as keyof typeof gradients] || 'rgba(107,114,128,0.3)'
  }

  const getCategoryIcon = (category: string) => {
    const icons = {
      Development: '💻',
      Design: '🎨',
      Performance: '⚡',
      AI: '🤖',
      'UX/UI': '✨',
      Technology: '🔧',
      Tutorial: '📚',
      'Case Study': '📊',
    }
    return icons[category as keyof typeof icons] || '📝'
  }

  // Pagination logic
  const totalPages = Math.ceil(blogPosts.length / postsPerPage)
  const startIndex = (currentPage - 1) * postsPerPage
  const endIndex = startIndex + postsPerPage
  const currentPosts = blogPosts.slice(startIndex, endIndex)

  const handlePageChange = (page: number) => {
    setCurrentPage(page)
    window.scrollTo({ top: 0, behavior: 'smooth' })
  }

  return (
    <section id="blog" className="section-padding bg-gray-800/30">
      <div className="container-custom">
        <motion.div
          ref={ref}
          variants={containerVariants}
          initial="hidden"
          animate={isInView ? 'visible' : 'hidden'}
          className="max-w-6xl mx-auto"
        >
          {/* Section Header */}
          <motion.div variants={itemVariants} className="text-center mb-8 md:mb-16 px-4">
            <div className="flex flex-col md:flex-row items-center justify-center mb-4 md:mb-6 gap-4">
              <h2 className="text-3xl sm:text-4xl md:text-5xl font-bold leading-tight text-center">
                <AnimatedText text={t.blog.title} />
            </h2>
              {isAdmin && (
                <div className="flex gap-2 md:gap-3">
                  <button
                    onClick={handleAdd}
                    className="flex items-center gap-2 px-3 md:px-4 py-2 bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors text-sm md:text-base"
                  >
                    <PlusIcon className="w-4 h-4 md:w-5 md:h-5" />
                    <span className="hidden sm:inline">{t.blog.addPost}</span>
                    <span className="sm:hidden">Ekle</span>
                  </button>
                  <button
                    onClick={() => {
                      setIsAdmin(false)
                      localStorage.setItem('adminMode', 'false')
                    }}
                    className="px-3 md:px-4 py-2 rounded-lg transition-colors bg-green-500 hover:bg-green-600 text-sm md:text-base"
                  >
                    <span className="hidden sm:inline">{t.blog.adminModeOn}</span>
                    <span className="sm:hidden">Çıkış</span>
                  </button>
                </div>
              )}
            </div>
            <div className="w-24 h-1 bg-[#F97316] mx-auto rounded-full" />
            <p className="text-base sm:text-lg text-gray-400 mt-4 md:mt-6 max-w-2xl mx-auto leading-relaxed">
              {t.blog.subtitle}
            </p>
          </motion.div>

          {/* Featured Posts */}
          <motion.div variants={itemVariants} className="mb-8 md:mb-16 px-4">
            <h3 className="text-xl md:text-2xl font-semibold mb-6 md:mb-8">
              <AnimatedText text={t.blog.featured} />
            </h3>
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6">
              {blogPosts.map((post, index) => (
                <motion.article
                  key={post.slug}
                  initial={{ opacity: 0, y: 30 }}
                  animate={isInView ? { opacity: 1, y: 0 } : { opacity: 0, y: 30 }}
                  transition={{ duration: 0.6, delay: 0.2 + index * 0.2 }}
                  className="card card-hover group cursor-pointer h-full"
                >
                  {/* Post Image Placeholder */}
                  <div className="relative overflow-hidden rounded-lg mb-3 group-hover:scale-105 transition-transform">
                    <div className="w-full h-12 bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center relative">
                      {/* Uploaded Image */}
                      {/* Estetik tasarım */}
                      <div className="absolute inset-0 opacity-20">
                        <div className="w-full h-full" style={{
                          backgroundImage: `linear-gradient(45deg, ${getCategoryGradient(post.category)} 25%, transparent 25%), linear-gradient(-45deg, ${getCategoryGradient(post.category)} 25%, transparent 25%)`,
                          backgroundSize: '20px 20px'
                        }} />
                      </div>
                      <div className="absolute inset-0 flex items-center justify-center">
                        <div className="text-center">
                          <div className="mb-1">
                            <span className="text-white font-bold text-2xl drop-shadow-lg">{getCategoryIcon(post.category)}</span>
                          </div>
                          <span className="text-gray-300 text-sm font-medium">{post.category}</span>
                        </div>
                      </div>
                      
                      {/* Image Upload Button - Admin Only */}
                      {isAdmin && (
                        <div className="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-10">
                          <label className="cursor-pointer">
                            <input
                              type="file"
                              accept="image/*"
                              onChange={async (e) => {
                                const file = e.target.files?.[0]
                                if (file) {
                                  const reader = new FileReader()
                                  reader.onloadend = async () => {
                                    const base64String = reader.result as string
                                    
                                    console.log('📤 Uploading blog image to Supabase...')
                                    const result = await uploadImageToSupabase(
                                      base64String,
                                      'blog',
                                      `blog-${post.slug}-${Date.now()}`
                                    )
                                    
                                    console.log('📥 Upload result:', result)
                                    
                                    if (result.success && result.url) {
                                      const updatedPosts = [...blogPosts]
                                      updatedPosts[blogPosts.indexOf(post)].image = result.url
                                      setBlogPosts(updatedPosts)
                                      localStorage.setItem('blogPosts', JSON.stringify(updatedPosts))
                                      alert('Görsel Supabase\'e yüklendi ve herkese görünecek!')
                                    } else {
                                      console.error('❌ Upload failed:', result.error)
                                      const updatedPosts = [...blogPosts]
                                      updatedPosts[blogPosts.indexOf(post)].image = base64String
                                      setBlogPosts(updatedPosts)
                                      localStorage.setItem('blogPosts', JSON.stringify(updatedPosts))
                                      alert('Görsel kaydedildi (sadece sizde görünecek)')
                                    }
                                  }
                                  reader.readAsDataURL(file)
                                }
                              }}
                              className="hidden"
                            />
                            <div className="flex items-center gap-2 px-4 py-2 bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors">
                              <PhotoIcon className="w-5 h-5 text-white" />
                              <span className="text-white font-medium">
                                {post.image ? 'Değiştir' : 'Görsel Yükle'}
                              </span>
                            </div>
                          </label>
                        </div>
                      )}
                      
                      {/* Edit/Delete Buttons - Admin Only */}
                      {isAdmin && (
                        <div className="absolute top-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity z-20">
                          <button
                            onClick={(e) => {
                              e.stopPropagation()
                              handleEdit(post, blogPosts.indexOf(post))
                            }}
                            className="p-2 bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors"
                          >
                            <PencilIcon className="w-4 h-4 text-white" />
                          </button>
                          <button
                            onClick={(e) => {
                              e.stopPropagation()
                              handleDelete(blogPosts.indexOf(post))
                            }}
                            className="p-2 bg-red-500 hover:bg-red-600 rounded-lg transition-colors"
                          >
                            <TrashIcon className="w-4 h-4 text-white" />
                          </button>
                        </div>
                      )}
                    </div>
                    <div className="absolute top-4 left-4 z-20">
                      <span className={`px-3 py-1 rounded-full text-sm font-medium border ${getCategoryColor(post.category)}`}>
                        {post.category}
                      </span>
                    </div>
                  </div>

                  {/* Post Content */}
                  <div className="p-3">
                    <h4 className="text-xl font-semibold text-white mb-3 group-hover:text-primary-400 transition-colors">
                      {post.title}
                    </h4>
                    <p className="text-gray-400 mb-4 leading-relaxed">
                      {post.excerpt}
                    </p>
                    
                    {/* Post Meta */}
                    <div className="flex items-center justify-between text-sm text-gray-500 mb-4">
                      <div className="flex items-center space-x-4">
                        <div className="flex items-center space-x-1">
                          <CalendarIcon className="w-4 h-4" />
                          <span>{new Date(post.date).toLocaleDateString('tr-TR', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
                        </div>
                        <div className="flex items-center space-x-1">
                          <ClockIcon className="w-4 h-4" />
                          <span>{post.readTime}</span>
                        </div>
                      </div>
                    </div>

                    {/* Read More */}
                    <Link href={`/blog/${post.slug}`} className="flex items-center text-primary-500 font-medium group-hover:text-primary-400 transition-colors">
                      <span>{t.blog.readMore}</span>
                      <ArrowRightIcon className="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform" />
                    </Link>
                  </div>
                </motion.article>
              ))}
            </div>
          </motion.div>

              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6">
                {currentPosts.map((post, index) => (
                <motion.article
                  key={post.slug}
                  initial={{ opacity: 0, y: 30 }}
                  animate={isInView ? { opacity: 1, y: 0 } : { opacity: 0, y: 30 }}
                  transition={{ duration: 0.6, delay: 0.4 + index * 0.1 }}
                  className="card card-hover group cursor-pointer h-full"
                >
                  {/* Post Image Placeholder */}
                  <div className="relative overflow-hidden rounded-lg mb-4 group-hover:scale-105 transition-transform">
                    <div className="w-full h-12 bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center relative">
                      {/* Uploaded Image */}
                      {post.image ? (
                        <img src={post.image} alt={post.title} className="w-full h-full object-cover" />
                      ) : (
                        <>
                          <div className="absolute inset-0 opacity-10">
                            <div className="w-full h-full" style={{
                              backgroundImage: 'linear-gradient(45deg, rgba(249,115,22,0.1) 25%, transparent 25%), linear-gradient(-45deg, rgba(249,115,22,0.1) 25%, transparent 25%)',
                              backgroundSize: '20px 20px'
                            }} />
                          </div>
                          <span className="text-gray-400 text-sm relative z-10">Blog Görseli</span>
                        </>
                      )}
                      
                      {/* Image Upload Button - Admin Only */}
                      {isAdmin && (
                        <div className="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-10">
                          <label className="cursor-pointer">
                            <input
                              type="file"
                              accept="image/*"
                              onChange={(e) => {
                                const file = e.target.files?.[0]
                                if (file) {
                                  const reader = new FileReader()
                                  reader.onloadend = () => {
                                    const base64String = reader.result as string
                                    const updatedPosts = [...blogPosts]
                                    updatedPosts[blogPosts.indexOf(post)].image = base64String
                                    setBlogPosts(updatedPosts)
                                    localStorage.setItem('blogPosts', JSON.stringify(updatedPosts))
                                  }
                                  reader.readAsDataURL(file)
                                }
                              }}
                              className="hidden"
                            />
                            <div className="flex items-center gap-2 px-3 py-1.5 bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors">
                              <PhotoIcon className="w-4 h-4 text-white" />
                              <span className="text-white text-sm font-medium">
                                {post.image ? 'Değiştir' : 'Görsel'}
                              </span>
                            </div>
                          </label>
                        </div>
                      )}
                      
                      {/* Edit/Delete Buttons - Admin Only */}
                      {isAdmin && (
                        <div className="absolute top-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity z-20">
                          <button
                            onClick={(e) => {
                              e.stopPropagation()
                              handleEdit(post, blogPosts.indexOf(post))
                            }}
                            className="p-1.5 bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors"
                          >
                            <PencilIcon className="w-3 h-3 text-white" />
                          </button>
                          <button
                            onClick={(e) => {
                              e.stopPropagation()
                              handleDelete(blogPosts.indexOf(post))
                            }}
                            className="p-1.5 bg-red-500 hover:bg-red-600 rounded-lg transition-colors"
                          >
                            <TrashIcon className="w-3 h-3 text-white" />
                          </button>
                        </div>
                      )}
                    </div>
                    <div className="absolute top-3 left-3 z-20">
                      <span className={`px-2 py-1 rounded-full text-xs font-medium border ${getCategoryColor(post.category)}`}>
                        {post.category}
                      </span>
                    </div>
                  </div>

                  {/* Post Content */}
                  <div className="p-3">
                    <h4 className="text-lg font-semibold text-white mb-2 group-hover:text-primary-400 transition-colors">
                      {post.title}
                    </h4>
                    <p className="text-gray-400 text-sm mb-3 leading-relaxed">
                      {post.excerpt}
                    </p>
                    
                    {/* Post Meta */}
                    <div className="flex items-center justify-between text-xs text-gray-500 mb-3">
                      <div className="flex items-center space-x-3">
                        <div className="flex items-center space-x-1">
                          <CalendarIcon className="w-3 h-3" />
                          <span>{new Date(post.date).toLocaleDateString('tr-TR', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
                        </div>
                        <div className="flex items-center space-x-1">
                          <ClockIcon className="w-3 h-3" />
                          <span>{post.readTime}</span>
                        </div>
                      </div>
                    </div>

                    {/* Read More */}
                    <Link href={`/blog/${post.slug}`} className="flex items-center text-primary-500 font-medium text-sm group-hover:text-primary-400 transition-colors">
                      <span>{t.blog.readMore}</span>
                      <ArrowRightIcon className="w-3 h-3 ml-1 group-hover:translate-x-1 transition-transform" />
                    </Link>
                  </div>
                </motion.article>
              ))}
            </div>
          </motion.div>

          {/* View All Posts Button - Only on Homepage */}
          {isHomePage && (
            <motion.div 
              variants={itemVariants}
              className="text-center mt-12"
            >
              <Link href="/blog">
                <motion.button
                  whileHover={{ scale: 1.05 }}
                  whileTap={{ scale: 0.95 }}
                  className="btn-secondary"
                >
                  Tüm Yazıları Gör
                </motion.button>
              </Link>
            </motion.div>
          )}
      </div>

      {/* Edit Modal */}
      {showEditModal && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
          <motion.div
            initial={{ opacity: 0, scale: 0.9 }}
            animate={{ opacity: 1, scale: 1 }}
            className="bg-gray-900 rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto"
          >
            <h3 className="text-2xl font-bold mb-4">Blog Yazısını Düzenle</h3>
            
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium mb-2">Başlık</label>
                <input
                  type="text"
                  value={editForm.title || ''}
                  onChange={(e) => setEditForm({ ...editForm, title: e.target.value })}
                  className="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white"
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">Özet</label>
                <textarea
                  value={editForm.excerpt || ''}
                  onChange={(e) => setEditForm({ ...editForm, excerpt: e.target.value })}
                  className="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white"
                  rows={3}
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">Slug (URL)</label>
                <input
                  type="text"
                  value={editForm.slug || ''}
                  onChange={(e) => setEditForm({ ...editForm, slug: e.target.value })}
                  className="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white"
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">İçerik</label>
                <textarea
                  value={editForm.content || ''}
                  onChange={(e) => setEditForm({ ...editForm, content: e.target.value })}
                  className="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white"
                  rows={8}
                  placeholder="Blog yazısının tam içeriğini buraya yazın..."
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">Kategori</label>
                <select
                  value={editForm.category || ''}
                  onChange={(e) => setEditForm({ ...editForm, category: e.target.value })}
                  className="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white"
                >
                  <option value="Development">Development</option>
                  <option value="Design">Design</option>
                  <option value="Performance">Performance</option>
                </select>
              </div>

              <div className="flex gap-2">
                <button
                  onClick={handleSaveEdit}
                  className="flex items-center gap-2 px-4 py-2 bg-primary-500 hover:bg-primary-600 rounded-lg"
                >
                  <CheckIcon className="w-5 h-5" />
                  Kaydet
                </button>
                <button
                  onClick={handleCancel}
                  className="flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg"
                >
                  <XMarkIcon className="w-5 h-5" />
                  İptal
                </button>
              </div>
            </div>
          </motion.div>
        </div>
      )}

      {/* Add Modal */}
      {showAddModal && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
          <motion.div
            initial={{ opacity: 0, scale: 0.9 }}
            animate={{ opacity: 1, scale: 1 }}
            className="bg-gray-900 rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto"
          >
            <h3 className="text-2xl font-bold mb-4">Yeni Blog Yazısı</h3>
            
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium mb-2">Başlık</label>
                <input
                  type="text"
                  value={editForm.title || ''}
                  onChange={(e) => setEditForm({ ...editForm, title: e.target.value })}
                  className="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white"
                  placeholder="Blog yazısı başlığı"
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">Özet</label>
                <textarea
                  value={editForm.excerpt || ''}
                  onChange={(e) => setEditForm({ ...editForm, excerpt: e.target.value })}
                  className="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white"
                  rows={3}
                  placeholder="Kısa açıklama"
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">Slug (URL)</label>
                <input
                  type="text"
                  value={editForm.slug || ''}
                  onChange={(e) => setEditForm({ ...editForm, slug: e.target.value })}
                  className="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white"
                  placeholder="blog-yazisi-url"
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">İçerik</label>
                <textarea
                  value={editForm.content || ''}
                  onChange={(e) => setEditForm({ ...editForm, content: e.target.value })}
                  className="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white"
                  rows={8}
                  placeholder="Blog yazısının tam içeriğini buraya yazın..."
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">Kategori</label>
                <select
                  value={editForm.category || ''}
                  onChange={(e) => setEditForm({ ...editForm, category: e.target.value })}
                  className="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white"
                >
                  <option value="Development">Development</option>
                  <option value="Design">Design</option>
                  <option value="Performance">Performance</option>
                </select>
              </div>

              <div className="flex gap-2">
                <button
                  onClick={handleSaveAdd}
                  className="flex items-center gap-2 px-4 py-2 bg-primary-500 hover:bg-primary-600 rounded-lg"
                >
                  <CheckIcon className="w-5 h-5" />
                  Ekle
                </button>
                <button
                  onClick={handleCancel}
                  className="flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg"
                >
                  <XMarkIcon className="w-5 h-5" />
                  İptal
                </button>
              </div>
            </div>
          </motion.div>
        </div>
      )}

      {/* Password Modal */}
      {showPasswordModal && (
        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
          <motion.div
            initial={{ opacity: 0, scale: 0.9 }}
            animate={{ opacity: 1, scale: 1 }}
            className="bg-gray-900 rounded-lg p-6 max-w-md w-full border border-gray-700"
          >
            <h3 className="text-2xl font-bold mb-4 text-white">Admin Girişi</h3>
            <p className="text-gray-400 mb-4">Lütfen admin şifresini girin:</p>
            
            <input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && handlePasswordSubmit()}
              className="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white mb-4 focus:outline-none focus:ring-2 focus:ring-primary-500"
              placeholder="Şifre"
              autoFocus
            />
            
            <div className="flex gap-2">
              <button
                onClick={handlePasswordSubmit}
                className="flex-1 px-4 py-2 bg-primary-500 hover:bg-primary-600 rounded-lg text-white transition-colors"
              >
                Giriş Yap
              </button>
              <button
                onClick={() => {
                  setShowPasswordModal(false)
                  setPassword('')
                }}
                className="flex-1 px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-white transition-colors"
              >
                İptal
              </button>
            </div>
          </motion.div>
        </div>
      )}
    </section>
  )
}

